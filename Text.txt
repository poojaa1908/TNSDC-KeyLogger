let
    Source = PreviousStepName,

    // Step 1: Find the maximum list length across all rows
    MaxLength = List.Max(List.Transform(Source[hits], each if Value.Is(_, type list) then List.Count(_) else 0)),

    // Step 2: Generate column names dynamically: "hit1", "hit2", ..., "hitN"
    ColumnNames = List.Transform({1..MaxLength}, each "hit" & Text.From(_)),

    // Step 3: Add new column that transforms list to record with those column names
    WithRecord = Table.AddColumn(Source, "ExpandedHits", each 
        let
            lst = if Value.Is([hits], type list) then [hits] else {},
            rec = Record.FromList(lst, ColumnNames)
        in
            rec
    ),

    // Step 4: Expand the record into individual columns
    Expanded = Table.ExpandRecordColumn(WithRecord, "ExpandedHits", ColumnNames)
in
    Expanded
